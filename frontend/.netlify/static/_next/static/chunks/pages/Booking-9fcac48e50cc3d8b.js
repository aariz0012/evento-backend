(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[285],{1179:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/Booking",function(){return t(357)}])},357:function(e,s,t){"use strict";t.r(s);var a=t(1010),n=t(1309),r=t(7582),l=t(5893),i=t(7294),d=t(1163),c=t(1664),o=t.n(c),m=t(8120),x=t(7066),u=t(7803),h=t(2298),y=t(2920),b=t(9583),j=t(3495),p=t(4465),g=t(6664),v=t(4155),f=(0,p.J)(v.env.REACT_APP_STRIPE_PUBLIC_KEY),N=function(e){var s,t=e.venueId,d=e.startDate,c=e.endDate,o=e.totalPrice,u=e.onSuccess,h=e.onError,y=e.processingPayment,j=e.setProcessingPayment,p=(0,g.useStripe)(),v=(0,g.useElements)(),f=(0,m.aC)().user,N=(0,n._)((0,i.useState)(null),2),w=N[0],k=N[1],_=(s=(0,a._)(function(e){var s,a,n,l,i,m,y;return(0,r.Jh)(this,function(r){switch(r.label){case 0:if(e.preventDefault(),!p||!v)return[2];j(!0),k(null),r.label=1;case 1:return r.trys.push([1,7,8,9]),[4,x.Z.post("".concat("https://evento-backend.onrender.com","/bookings/payment-intent"),{amount:100*o,venueId:t,startDate:d,endDate:c,userId:f.id})];case 2:return s=r.sent().data,[4,p.confirmCardPayment(s.clientSecret,{payment_method:{card:v.getElement(g.CardElement),billing_details:{name:f.name,email:f.email}}})];case 3:if(n=(a=r.sent()).error,l=a.paymentIntent,!n)return[3,4];return k(n.message),h(n.message),[3,6];case 4:if("succeeded"!==l.status)return[3,6];return[4,x.Z.post("".concat("https://evento-backend.onrender.com","/bookings"),{venueId:t,startDate:d,endDate:c,totalAmount:o,paymentIntentId:l.id},{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}})];case 5:u(r.sent().data.data),r.label=6;case 6:return[3,9];case 7:return console.error("Payment error:",i=r.sent()),h((null===(m=i.response)||void 0===m?void 0:null===(y=m.data)||void 0===y?void 0:y.message)||"Payment processing failed"),[3,9];case 8:return j(!1),[7];case 9:return[2]}})}),function(e){return s.apply(this,arguments)});return(0,l.jsxs)("form",{onSubmit:_,className:"mt-4",children:[(0,l.jsxs)("div",{className:"mb-4",children:[(0,l.jsx)("label",{className:"block text-gray-700 mb-2 font-semibold",children:"Card Details"}),(0,l.jsx)("div",{className:"border border-gray-300 p-3 rounded-md",children:(0,l.jsx)(g.CardElement,{options:{style:{base:{fontSize:"16px",color:"#424770","::placeholder":{color:"#aab7c4"}},invalid:{color:"#9e2146"}}}})}),w&&(0,l.jsx)("div",{className:"text-red-600 text-sm mt-2",children:w})]}),(0,l.jsxs)("div",{className:"flex items-center mb-4 text-sm text-gray-600",children:[(0,l.jsx)(b.kUi,{className:"mr-2"}),(0,l.jsx)("span",{children:"Your payment information is secure and encrypted"})]}),(0,l.jsx)("button",{type:"submit",disabled:!p||y,className:"w-full bg-blue-600 hover:bg-blue-700 text-white py-3 px-4 rounded-md transition duration-300 ease-in-out disabled:bg-blue-400 flex justify-center items-center",children:y?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,l.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,l.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Processing..."]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(b.ypE,{className:"mr-2"}),"Complete Booking - $",o.toFixed(2)]})})]})};s.default=function(){var e,s,t,c,p,v=(0,d.useRouter)(),w=v.query.id,k=(0,m.aC)(),_=k.isAuthenticated,P=k.user,D=(0,n._)((0,i.useState)(null),2),E=D[0],S=D[1],C=(0,n._)((0,i.useState)(!0),2),M=C[0],I=C[1],B=(0,n._)((0,i.useState)(null),2),F=B[0],q=B[1],A=(0,n._)((0,i.useState)(!1),2),T=A[0],$=A[1],L=(0,n._)((0,i.useState)(!1),2),Y=L[0],J=L[1],z=(0,n._)((0,i.useState)(null),2),O=z[0],U=z[1],Z=(null===(e=v.query)||void 0===e?void 0:e.startDate)?new Date(v.query.startDate):new Date,R=new Date((null===(s=v.query)||void 0===s?void 0:s.endDate)?v.query.endDate:new Date().setDate(new Date().getDate()+1)),V=(0,u.Z)(R,Z)||1;(0,i.useEffect)(function(){if(!_){y.Am.error("You must be logged in to book a venue"),v.push("/login",{query:{from:"/venues/".concat(w)}});return}var e,s=(e=(0,a._)(function(){var e,s;return(0,r.Jh)(this,function(t){switch(t.label){case 0:if(t.trys.push([0,2,,3]),I(!0),null===(e=v.query)||void 0===e?void 0:e.venue)return S(v.query.venue),I(!1),[2];return[4,x.Z.get("".concat("https://evento-backend.onrender.com","/venues/").concat(w))];case 1:return(s=t.sent()).data&&s.data.data&&S(s.data.data),I(!1),[3,3];case 2:return console.error("Error fetching venue details:",t.sent()),q("Failed to load venue details. Please try again later."),I(!1),[3,3];case 3:return[2]}})}),function(){return e.apply(this,arguments)});w&&s()},[w,_,v.push,v.query]);var W=function(){if(!E)return{subtotal:0,serviceFee:0,total:0};var e=E.price*V,s=.1*e;return{subtotal:e,serviceFee:s,total:e+s}}(),H=W.subtotal,X=W.serviceFee,K=W.total;return M?(0,l.jsx)("div",{className:"flex justify-center items-center h-screen",children:(0,l.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):F?(0,l.jsx)("div",{className:"flex justify-center items-center h-screen",children:(0,l.jsx)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded",children:(0,l.jsx)("p",{children:F})})}):E?Y&&O?(0,l.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,l.jsxs)(j.E.div,{className:"max-w-2xl mx-auto bg-white rounded-lg shadow-lg p-8",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:[(0,l.jsxs)("div",{className:"text-center mb-6",children:[(0,l.jsx)("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-green-100 rounded-full mb-4",children:(0,l.jsx)("svg",{className:"w-8 h-8 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})})}),(0,l.jsx)("h1",{className:"text-3xl font-bold text-gray-800",children:"Booking Confirmed!"}),(0,l.jsx)("p",{className:"text-gray-600 mt-2",children:"Thank you for your booking. Your confirmation details are below."})]}),(0,l.jsxs)("div",{className:"border-t border-b border-gray-200 py-4 mb-6",children:[(0,l.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Booking Details"}),(0,l.jsxs)("div",{className:"space-y-3",children:[(0,l.jsxs)("div",{className:"flex items-start",children:[(0,l.jsx)("div",{className:"w-8 text-gray-500",children:(0,l.jsx)(b.Nh4,{})}),(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"font-semibold",children:E.name}),(0,l.jsx)("p",{className:"text-gray-600",children:E.location?"".concat(E.location.address,", ").concat(E.location.city):"Location not specified"})]})]}),(0,l.jsxs)("div",{className:"flex items-start",children:[(0,l.jsx)("div",{className:"w-8 text-gray-500",children:(0,l.jsx)(b.IiJ,{})}),(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"font-semibold",children:"Booking Period"}),(0,l.jsxs)("p",{className:"text-gray-600",children:[(0,h.default)(Z,"MMM dd, yyyy")," - ",(0,h.default)(R,"MMM dd, yyyy")]}),(0,l.jsxs)("p",{className:"text-gray-600",children:[V," ",1===V?"day":"days"]})]})]}),(0,l.jsxs)("div",{className:"flex items-start",children:[(0,l.jsx)("div",{className:"w-8 text-gray-500",children:(0,l.jsx)(b.I$,{})}),(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"font-semibold",children:"Capacity"}),(0,l.jsxs)("p",{className:"text-gray-600",children:["Up to ",E.capacity," people"]})]})]}),(0,l.jsxs)("div",{className:"flex items-start",children:[(0,l.jsx)("div",{className:"w-8 text-gray-500",children:(0,l.jsx)(b.ypE,{})}),(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"font-semibold",children:"Payment"}),(0,l.jsxs)("p",{className:"text-gray-600",children:["Total paid: $",K.toFixed(2)]}),(0,l.jsxs)("p",{className:"text-gray-600",children:["Booking ID: ",O._id]})]})]})]})]}),(0,l.jsxs)("div",{className:"text-center space-y-4",children:[(0,l.jsxs)("p",{className:"text-gray-600",children:["We've sent a confirmation email to ",(0,l.jsx)("span",{className:"font-semibold",children:P.email})," with all the details."]}),(0,l.jsxs)("div",{className:"flex flex-col sm:flex-row justify-center gap-4",children:[(0,l.jsx)(o(),{href:"/profile",className:"bg-blue-600 hover:bg-blue-700 text-white py-2 px-6 rounded-md transition duration-300 ease-in-out",children:"View My Bookings"}),(0,l.jsx)(o(),{href:"/",className:"bg-gray-200 hover:bg-gray-300 text-gray-800 py-2 px-6 rounded-md transition duration-300 ease-in-out",children:"Back to Home"})]})]})]})}):(0,l.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,l.jsxs)("div",{className:"mb-6",children:[(0,l.jsx)(o(),{href:"/venues/".concat(w),className:"text-blue-600 hover:underline mb-4 inline-block",children:"â† Back to venue"}),(0,l.jsx)("h1",{className:"text-3xl font-bold mt-2",children:"Complete Your Booking"})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[(0,l.jsx)("div",{className:"lg:col-span-2",children:(0,l.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[(0,l.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Your Information"}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-gray-700 mb-2",children:"First Name"}),(0,l.jsx)("input",{type:"text",value:(null==P?void 0:null===(t=P.name)||void 0===t?void 0:t.split(" ")[0])||"",disabled:!0,className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-gray-700 mb-2",children:"Last Name"}),(0,l.jsx)("input",{type:"text",value:(null==P?void 0:null===(c=P.name)||void 0===c?void 0:c.split(" ").slice(1).join(" "))||"",disabled:!0,className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-gray-700 mb-2",children:"Email"}),(0,l.jsx)("input",{type:"email",value:(null==P?void 0:P.email)||"",disabled:!0,className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-gray-700 mb-2",children:"Phone"}),(0,l.jsx)("input",{type:"tel",value:(null==P?void 0:P.phone)||"",disabled:!0,className:"w-full p-2 border border-gray-300 rounded-md bg-gray-50"})]})]}),(0,l.jsxs)("div",{className:"mb-6",children:[(0,l.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Booking Details"}),(0,l.jsxs)("div",{className:"flex items-center mb-3",children:[(0,l.jsx)(b.IiJ,{className:"text-gray-500 mr-2"}),(0,l.jsxs)("span",{children:[(0,h.default)(Z,"MMM dd, yyyy")," - ",(0,h.default)(R,"MMM dd, yyyy")," (",V," ",1===V?"day":"days",")"]})]}),(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)(b.I$,{className:"text-gray-500 mr-2"}),(0,l.jsxs)("span",{children:["Capacity: Up to ",E.capacity," people"]})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Payment"}),(0,l.jsx)(g.Elements,{stripe:f,children:(0,l.jsx)(N,{venueId:w,startDate:Z.toISOString(),endDate:R.toISOString(),totalPrice:K,onSuccess:function(e){J(!0),U(e),y.Am.success("Booking completed successfully!")},onError:function(e){y.Am.error(e||"Payment failed. Please try again.")},processingPayment:T,setProcessingPayment:$})})]})]})}),(0,l.jsx)("div",{className:"lg:col-span-1",children:(0,l.jsxs)(j.E.div,{className:"bg-white rounded-lg shadow-md p-6 sticky top-6",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:[(0,l.jsx)("h2",{className:"text-xl font-semibold border-b pb-4 mb-4",children:"Booking Summary"}),(0,l.jsxs)("div",{className:"flex items-start mb-4",children:[(0,l.jsx)("div",{className:"w-20 h-20 bg-gray-200 rounded-md overflow-hidden mr-4",children:E.images&&E.images.length>0?(0,l.jsx)("img",{src:E.images[0],alt:E.name,className:"w-full h-full object-cover"}):(0,l.jsx)("div",{className:"w-full h-full flex items-center justify-center bg-gray-300 text-gray-600",children:"No image"})}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"font-semibold",children:E.name}),(0,l.jsx)("p",{className:"text-gray-600 text-sm",children:E.location?"".concat(E.location.city,", ").concat(E.location.state):"Location not specified"})]})]}),(0,l.jsxs)("div",{className:"border-t border-b py-4 mb-4",children:[(0,l.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,l.jsx)("span",{children:"Check-in"}),(0,l.jsx)("span",{className:"font-semibold",children:(0,h.default)(Z,"MMM dd, yyyy")})]}),(0,l.jsxs)("div",{className:"flex justify-between",children:[(0,l.jsx)("span",{children:"Check-out"}),(0,l.jsx)("span",{className:"font-semibold",children:(0,h.default)(R,"MMM dd, yyyy")})]})]}),(0,l.jsxs)("div",{className:"mb-4",children:[(0,l.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,l.jsxs)("span",{children:["$",null===(p=E.price)||void 0===p?void 0:p.toFixed(2)," x ",V," ",1===V?"day":"days"]}),(0,l.jsxs)("span",{children:["$",H.toFixed(2)]})]}),(0,l.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,l.jsx)("span",{children:"Service fee"}),(0,l.jsxs)("span",{children:["$",X.toFixed(2)]})]}),(0,l.jsxs)("div",{className:"flex justify-between font-bold text-lg pt-2 border-t",children:[(0,l.jsx)("span",{children:"Total"}),(0,l.jsxs)("span",{children:["$",K.toFixed(2)]})]})]}),(0,l.jsx)("div",{className:"text-sm text-gray-600",children:(0,l.jsxs)("p",{children:["By proceeding with the booking, you agree to our ",(0,l.jsx)("a",{href:"/terms",className:"text-blue-600 hover:underline",children:"Terms of Service"})," and ",(0,l.jsx)("a",{href:"/privacy",className:"text-blue-600 hover:underline",children:"Privacy Policy"}),"."]})})]})})]})]}):(0,l.jsx)("div",{className:"flex justify-center items-center h-screen",children:(0,l.jsx)("div",{className:"bg-yellow-100 border border-yellow-400 text-yellow-700 px-4 py-3 rounded",children:(0,l.jsx)("p",{children:"Venue not found"})})})}}},function(e){e.O(0,[445,949,298,998,774,888,179],function(){return e(e.s=1179)}),_N_E=e.O()}]);